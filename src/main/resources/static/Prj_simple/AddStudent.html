<!DOCTYPE html>
<html>
<head>
  <title>Student Enrollment Form</title>
  <!-- Add Bootstrap CSS link -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    /* Custom style for input fields */
    .form-control {
      margin-bottom: 10px;
      padding: 8px;
    }
  </style>
</head>
<body>
  <div class="container mt-5">

    <div class="container mt-5">

    <ul class="nav nav-tabs">
      <li class="nav-item">
        <a class="nav-link active" data-toggle="tab" href="#student-details">Student Details</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-toggle="tab" href="#assignments">Assignments</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-toggle="tab" href="#tests">Tests</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-toggle="tab" href="#notes">Notes</a>
      </li>
    </ul>

    
    <div class="tab-content mt-4">
      <!-- Student Details Tab Content -->
      <div id="student-details" class="tab-pane fade show active">
        <div class="alert alert-success" id="success-alert3">
          <button type="button" class="close" data-dismiss="alert">x</button>
          <strong>Message!</strong>
          No student details found!
       </div>
       <div class="alert alert-danger" id="success-dange3">
        <button type="button" class="close" data-dismiss="alert">x</button>
        <strong>Message!</strong>
        No student details found!
     </div>
       
     <h3>Student Enrollment Form</h3>
     <!-- <div class="alert alert-success" id="success-alert">
         <button type="button" class="close" data-dismiss="alert">x</button>
         <strong>Message!</strong>
         No student details found!
      </div> -->
     <form class="form-inline">
       <div class="form-group mr-2">
         <label for="enrollmentId">Enrollment ID:</label>
         <input type="text" class="form-control" id="enrollmentId" name="enrollmentId" required>
       </div>
       <div class="form-group mr-2">
         <label for="branch">Branch:</label>
         <input type="text" class="form-control" id="branch" name="branch" required>
       </div>
       <div class="form-group mr-2">
         <label for="contactno">Contact Number:</label>
         <input type="text" class="form-control" id="contactno" name="contactno" required>
       </div>
       <div class="form-group mr-2">
         <label for="fullname">Full Name:</label>
         <input type="text" class="form-control" id="fullname" name="fullname" required>
       </div>
       <div class="form-group mr-2">
         <label for="previousSemResult">Previous Semester Result:</label>
         <input type="text" class="form-control" id="previousSemResult" name="previousSemResult" required>
       </div>
       <div class="form-group mr-2">
         <label for="rollno">Roll Number:</label>
         <input type="text" class="form-control" id="rollno" name="rollno" required>
       </div>
       <div class="form-group">
         <label for="semester">Semester:</label>
         <input type="text" class="form-control" id="semester" name="semester" required>
       </div>
       <button type="button" id="btnSaveStudent" class="btn btn-primary ml-2">Submit</button>
       <button type="button" id="getStudentDetails" class="btn btn-primary ml-2">View Student Details</button>

     </form>
        <br>
        <div class="alert alert-danger" id="success-alert">
          <button type="button" class="close" data-dismiss="alert">x</button>
          <strong>Message!</strong>
          No student details found!
       </div>

        <div class="studentDetailsClz">
          <table class="table" id="studentDetailsTbl">
            <thead>
              <tr>
                <th scope="col">Roll No</th>
                <th scope="col">Fullname</th>
                <th scope="col">Contact No</th>
                <th scope="col">Enrollment No</th>
                <th scope="col">Semester</th>
                <th scope="col">Branch</th>
                <th scope="col">PreviousSemResult</th>
              </tr>
            </thead>
            <tbody>
            <!-- <tr>
              <th scope="row">1</th>
              <td>John Doe</td>
              <td>123-456-7890</td>
              <td>12345</td>
              <td>1</td>
              <td>Computer Science</td>
              <td>A</td>
            </tr> -->
            <!-- Add more rows as needed -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Assignments Tab Content -->
      <div id="assignments" class="tab-pane fade">
        <h3>Assignments</h3>
        <div class="row mt-1 mb-1">
          <div class="col">
            <div class="alert alert-success" id="success-alert2">
                <button type="button" class="close" data-dismiss="alert">x</button>
                <strong>Assignment Update Information!</strong>
                Assignments have been updated in student details.
              </div>
          </div>
        </div>
        <div class="row">
          <div class="col">
            
            <!-- Add Assignment Button -->
            <div class="row mb">
              <div class="col-md">
                <button id="getAssignmentBtn" class="btn btn-primary float-right"><i class="fa fa-plus-circle mr-2"></i>Get Assignment</button>
              </div>
            </div>
    
            <!-- Bootstrap Form for Adding Assignment -->
            <div class="row">
              <div class="col-md">
                <form>
                  <div class="form-group">
                    <label for="rollNoInput">Roll No</label>
                    <input type="text" class="form-control" id="rollNoInput" placeholder="Enter roll no">
                  </div>
                  <div class="form-group">
                    <label for="code">Assignment Code</label>
                    <!-- <input type="text" class="form-control" id="code" placeholder="Enter roll no"> -->
                    <select name="assignmentCode" class="form-control" id="assignmentCode">
                      <option value="--SELECT--">--SELECT--</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="question">Assignment</label>
                    <textarea disabled class="form-control" readonly id="assignmentsTxt" rows="10" placeholder="Assignments will be diplayed here"></textarea>
                  </div>
                  <div class="form-group float-right">
                    <input type="file" name="submitAssignment" id="submitAssignmentFile">
                    <button type="button" id="assgnmtSubmitBtn" class="btn btn-primary">Submit Assignment</button>
                  </div>
                </form>
              </div>
    
              <!-- <div class="row mb-3">
                <div class="col">
                  <button class="btn btn-primary" data-toggle="modal" data-target="#addAssignmentModal">Add Assignment</button>
                </div>
              </div> -->
      
              <!-- Bootstrap Modal for Adding Assignment -->
              <div class="modal fade" id="addAssignmentModal" tabindex="-1" role="dialog" aria-labelledby="addAssignmentModalLabel"
                aria-hidden="true" data-backdrop="static">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="addAssignmentModalLabel">Submit Assignment</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <div class="form-row">
                        <div class="form-group col-md-6">
                          <label for="branch">Branch</label>
                          <input type="text" class="form-control" id="branch" placeholder="Enter branch">
                        </div>
                        <div class="form-group col-md-6">
                          <label for="semester">Semester</label>
                          <input type="text" class="form-control" id="semester" placeholder="Enter semester">
                        </div>
                      </div>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                      <button type="button" id="submitAssignment" class="btn btn-primary">Submit</button>
                    </div>
                  </div>
                </div>
              </div>
              <!-- <div class="col-md-7">
                <div class="studentDetailsClz1">
                  <table class="table table-sm table-striped" id="viewAssignmentTbl">
                    <thead>
                      <tr>
                        <th scope="col">Sr No</th>
                        <th scope="col">Assignments</th>
                        <th scope="col">Action</th>
                      </tr>
                    </thead>
                    <tbody>
                    </tbody>
                  </table>
                </div>
                <div class="container mt-5">
                  <div class="text-center d-none" id="spinnerContainer">
                    <div class="spinner-border text-primary" role="status">
                      <span class="sr-only">Loading...</span>
                    </div>
                  </div>
                  <div class="text-center d-none" id="contentContainer">
                  </div>
                </div>
              </div> -->
              
              <div class="modal fade" id="myModal">
                <div class="modal-dialog modal-xl">
                  <div class="modal-content">
                    <!-- Modal Header -->
                    <div class="modal-header">
                      <h4 class="modal-title">Student Information</h4>
                      <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
              
                    <!-- Modal Body -->
                    <div class="modal-body">
                      <!-- Bootstrap table -->
                      <table id="submittedAssignmentsTbl" class="table table-bordered table-sm">
                        <thead>
                          <tr>
                            <th>Sr. No.</th>
                            <th>Full Name</th>
                            <th>Semester</th>
                            <th>Attachments</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td>1</td>
                            <td>John Doe</td>
                            <td>5th</td>
                            <td>file1.pdf</td>
                          </tr>
                          <tr>
                            <td>2</td>
                            <td>Jane Smith</td>
                            <td>3rd</td>
                            <td>file2.docx</td>
                          </tr>
                          <!-- Add more rows as needed -->
                        </tbody>
                      </table>
                    </div>
              
                    <!-- Modal Footer -->
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <ol id="questionOlList">
              
            </ol>
          </div>
        </div>
        
        <!-- End of Bootstrap Form -->
        <!-- Your content for Assignments tab goes here -->
        <!-- Add more content as needed -->
      </div>

      <!-- Tests Tab Content -->
      <div id="tests" class="tab-pane fade">
        <h3>Tests</h3>
        <!-- Your content for Tests tab goes here -->
        <form class="form-inline">

          <!-- Roll Number Input -->
          <div class="form-group mb-2">
            <label for="rollnotest" class="sr-only">Roll Number</label>
            <input type="text" class="form-control" id="rollnotest" name="rollnotest" placeholder="Enter Roll Number">
          </div>
      
          <!-- Subject Dropdown -->
          <div class="form-group mx-sm-3 mb-2">
            <label for="subject" class="sr-only">Subject</label>
            <select class="form-control" id="subject" name="subject">
              <option value="0">--SELECT--</option>
              <option value="OOP">OOP</option>
              <option value="AJP">AJP</option>
              <option value="STE">STE</option>
              <!-- Add more options if needed -->
            </select>
          </div>
      
          <!-- Test Dropdown -->
          <div class="form-group mx-sm-3 mb-2">
            <label for="test" class="sr-only">Test</label>
            <select class="form-control" id="test" name="test">
              <option value="0">--SELECT--</option>
              <option value="unitTest1">Unit Test 1</option>
              <option value="unitTest2">Unit Test 2</option>
              <!-- Add more options if needed -->
            </select>
          </div>
      
          <!-- Marks Input -->
          <div class="form-group mx-sm-3 mb-2">
            <label for="marks" class="sr-only">Marks</label>
            <input type="text" class="form-control" id="marks" name="marks" placeholder="Enter Marks">
          </div>
      
          <!-- Submit Button -->
          <button type="button" id="addMarksBtn" class="btn btn-primary mb-2 mr-3">Add Marks</button>
          <button type="button" id="updateMarksJson" class="btn btn-outline-success mb-2">Submit Result</button>

          <div class="alert alert-success" id="success-alert1">
            <button type="button" class="close" data-dismiss="alert">x</button>
            <strong>Message Update Information!</strong>
            Marks have been updated in student details.
         </div>
         <div class="alert alert-warning" id="warning-alert">
          <button type="button" class="close" data-dismiss="alert">x</button>
          <strong>Message Update Information!</strong>
          No Data found to update in student details.
       </div>
        </form>

        <div class="row">
          <div class="col">
            <p class="marksAddedJson"></p>
            
          </div>
        </div>

        <div class="row">
          <div class="col">
            <table id="marksAddedtbl" class="table">
              <thead>
                <tr>
                  <th>Roll No</th>
                  <th>Subject</th>
                  <th>Test</th>
                  <th>Marks</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>

              </tbody>
            </table>
          </div>
        </div>

      </div>

      <!-- Notes Tab Content -->
      <div id="notes" class="tab-pane fade">
        <h3>Notes</h3>
        <!-- Your content for Notes tab goes here -->
        <div class="row">
          <div id="my-alert" class="alert alert-danger hidden" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">    
                <span aria-hidden="true">&times;</span>
            </button> 
            <strong>Error:</strong> Failed to processing data from the API. Please try again later.
          </div>
        </div>
        <div class="row">
          <div class="col">
            <form class="form-inline">

              <!-- Roll Number Input -->
              <div class="form-group mb-2 mr-2">
                <label for="noteFile" class="sr-only">Choose File</label>
                <input type="file" class="form-control" id="noteFile" name="fileChoose" placeholder="" multiple="multiple">
              </div>
          
              <!-- Submit Button -->
              <button type="button" id="uploadNotes" class="btn btn-primary mb-2 mr-3">Upload Notes</button><br>
              <button type="button" id="getNotes" class="btn btn-primary mb-2 mr-3">Get Notes</button>

              
            
              
            </form>
          </div>
        </div>

        <div class="row">
          <div class="modal fade" id="myModal2">
            <div class="modal-dialog modal-xl">
              <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header">
                  <h4 class="modal-title">Student Information</h4>
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
          
                <!-- Modal Body -->
                <div class="modal-body">
                  <!-- Bootstrap table -->
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="semTxt">Semester</label>
                        <input type="text" class="form-control" id="semTxt" placeholder="Enter semester" />
                      </div>
                      <div class="form-group">
                        <button type="button" class="btn btn-primary" id="btnUpload">Upload</button>
                      </div>
                    </div>
                  </div>
                  
                </div>
          
                <!-- Modal Footer -->
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

    
  </div>

  <!-- Add Bootstrap JS and jQuery script links -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>


<script>

$(document).ready(function () {


      $("#success-alert").hide();
      $("#success-alert1").hide();
      $("#success-alert2").hide();
      $("#success-alert3").hide();
      $("#success-dange3").hide();
      
      $("#warning-alert").hide();
      $("#my-alert").hide();
    $('#btnSaveStudent').click(function(){
        addStudent();
    });

    $('#getStudentDetails').click(function getStudent() {
      getStudentDetails();
    })

    $('#assgnmtSubmitBtn').click(function() {
      submitAssignment();
    })

    function submitAssignment(){

      debugger
      var roll = $('#rollNoInput').val();
      var code = $('#assignmentCode option:selected').attr('value');

        if(roll !== '' && roll != null && code !== null && code!=='' && code !=='0'){

          const assgnmntFile = document.getElementById('submitAssignmentFile').files[0];
          
          if (!assgnmntFile) {
            alert('Please select a file to upload.');
            return;
          }

          const formData = new FormData();
          formData.append('file', assgnmntFile);
          formData.append('fileext', assgnmntFile.type);
          formData.append('rollno', roll);
          formData.append('code', code);
          fetch('https://student-information.up.railway.app/updateStudentAssignments', {
            method: 'POST',
            body: formData
          })
          .then(response => {
            if (response.ok) {
              alert('File uploaded successfully!');
              $('#myModal2').modal('hide');
            } else {
              alert('File upload failed.');
            }
          })
          .catch(error => {
            console.error('Error:', error);
            $("#my-alert").fadeTo(3000, 500).slideUp(500, function(){
              $("#my-alert").fadeOut(700);
            });
          });
          
        }else{
          alert("Enter roll no");
        }
    }

    $('#getAssignmentBtn').click(function() {
      if($('#rollNoInput').val() !=='' && $('#rollNoInput').val()!==null ){
        getAssignmentsByRollno();
      }else {
        alert('Enter valid rollno');
      }
    })

    function getAssignmentsByRollno() {
      $('#assignmentCode').html('');
      $('#assignmentCode').append($('<option></option>').attr('value', '0').text('--SELECT--'));
      var rollNo = $('#rollNoInput').val();
      $.ajax({
          type: "GET",
          url: "https://student-information.up.railway.app/getAssignmentsByRollno/" + rollNo,
          contentType: 'aaplication/json',
          success: function(data) {
            debugger
              console.log(data);
              if(data != null){
                debugger
                data.forEach(element => {
                  $('#assignmentCode').append($('<option></option>').attr('value', element.code).attr('data-value', element.assignment).text(element.code));
                })

                $("#assignmentCode").change(function() {
                  debugger
                  var selectedValue = $("#assignmentCode option:selected").val();
                  var dataValue = $("#assignmentCode option:selected").attr('data-value');
                  $('#assignmentsTxt').text('');
                  var resp = '';
                  debugger
                  if(dataValue !== undefined){
                    var data1 = dataValue.split(', ');
                    data1.forEach(element => {
                      resp = resp+element+"\n";
                    })
                  }
                  $('#assignmentsTxt').text(resp);
                  })
                // $('#assignmentsTxt').text('');
                // var resp = '';
                // data = data.replace('[','').replace(']','').split(', ');
                // data.forEach(element => {
                //   resp = resp+element+"\n";
                // })
                // $('#assignmentsTxt').text(resp);
              }
              // fillStudentDetailsTbl(data);

          },
          error: function (error) {
            debugger
              alert("error " + error);
              $('#assignmentsTxt').text('No Assignments Found');
              $("#success-dange3").fadeTo(3000, 500).slideUp(500, function(){
                  $("#success-dange3").slideUp(700);
              });
          }
      });

    }

    function getStudentDetails() {
      debugger
      var rollno = $('#rollno').val();
      $.ajax({
          type: "GET",
          dataType: "json",
          url: "https://student-information.up.railway.app/getStudentDetails/" + rollno,
          contentType: 'aaplication/json',
          success: function(data) {
            debugger
              console.log(data);
              fillStudentDetailsTbl(data);
          },
          error: function (error) {
            debugger
              alert("error " + error);
              $("#success-dange3").fadeTo(3000, 500).slideUp(500, function(){
                  $("#success-dange3").slideUp(700);
              });
          }
      });
    }

    function fillStudentDetailsTbl(data) {
          // console.log(data);
          $('#studentDetailsTbl>tbody').html('');
          if(data!=null && data.rollno != null && data.fullname != null && data.semester != null){
            $('#studentDetailsTbl>tbody').append('<tr><td>'+data.rollno+'</td><td>'+data.fullname+'</td><td>'+data.contactno+'</td><td>'+data.enrollmentId+'</td><td>'
              +data.semester+'</td><td>'+data.branch+'</td><td>'+data.previousSemResult+'</td></tr>');
          } else {
            $("#success-alert").fadeTo(3000, 500).slideUp(500, function(){
              $("#success-alert").slideUp(700);
            });
          }
        }


    function addStudent() {
        debugger
        var jData = new Object();

        var enrollmentId = $('#enrollmentId').val();
        var branch = $('#branch').val();
        var contactno = $('#contactno').val();
        var fullname = $('#fullname').val();
        var previousSemResult = $('#previousSemResult').val();
        var rollno = $('#rollno').val();
        var semester = $('#semester').val();


        jData['enrollmentId'] = enrollmentId;
        jData['branch'] = branch;
        jData['contactno'] = contactno;
        jData['fullname'] = fullname;
        jData['previousSemResult'] = previousSemResult;
        jData['rollno'] = rollno;
        jData['semester'] = semester;

          $.ajax({
              type: 'POST',
              url: 'https://student-information.up.railway.app/student_details',
              contentType: 'application/json',
              data: JSON.stringify(jData),
              success: function(data){
                  console.log(data);
                  debugger
                    updateAssignmentToNewlyAddedStudents();
                  if(data > 0){
                    
                    $("#success-alert").fadeTo(3000, 500).slideUp(500, function(){
                      $("#success-alert").slideUp(700);
                    });
                  } else {
                    $("#warning-alert").fadeTo(3000, 500).slideUp(500, function(){
                      $("#warning-alert").slideUp(700);
                    });
                  }
              },
              error: function(err){
                  console.log(err);
              }
          })

          function updateAssignmentToNewlyAddedStudents() {
            $.ajax({
            type: "GET",
            dataType: "json",
            url: "https://student-information.up.railway.app/updateAssignmentsToNewlyAddedStudents",
            contentType: 'aaplication/json',
            success: function(data) {
                console.log(data);
                $('#spinnerContainer').addClass('d-none');
              },
              error: function (error) {
                $('#spinnerContainer').addClass('d-none');
                alert("error " + error);
                
              }
            });
        }
    }
})
</script>
